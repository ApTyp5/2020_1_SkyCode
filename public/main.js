!function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(){return r.instance?r.instance:(this.events={},r.instance=this,this)}subscribe(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}unsubscribe(e,t){if(this.events[e]){const s=this.events[e].indexOf(t);this.events[e].splice(s,1)}}publish(e,t){const s=this.events[e];s&&s.length&&s.forEach(e=>e(t))}}var a=new r;var n=class{constructor(e){this._title=e}execute(e){this._view=e,document.body.innerHTML=this._view.html(),this._view.bind(),this.startCatchEvents()}stop(){void 0!==this._view&&(this.stopCatchEvents(),this._view.unbind(),this._view=void 0)}startCatchEvents(){}stopCatchEvents(){}get title(){return this._title}};class i{constructor(e,t,s){this.toString=this.html,this._context={},this.addContextData({classes:[]},!1),e&&this.addClasses(e),t&&this.addContextData(t),s&&(this._id=s,this.addContextData({id:s}))}static isComponent(e){return e instanceof i}get context(){return this._context}addContextData(e){Object.assign(this.context,e)}addClasses(e){const t="string"==typeof e;if(!Array.isArray(e)&&!t)throw"bad usage: must be str or strArr on entry";let s=e;t&&(s=e.split(" ")),this.context.classes.push(s)}get classes(){return this.context.classes.join(" ")}bind(){for(const e of Object.values(this.context))Array.isArray(e)&&e.forEach(e=>{i.isComponent(e)&&e.bind()}),i.isComponent(e)&&e.bind()}unbind(){for(const e of Object.values(this.context))e instanceof i&&e.unbind()}html(){return Handlebars.templates[this.constructor.name+".hbs"](this.context)}set id(e){this._id=e}get id(){return this._id}get domElement(){if(this._id)return document.getElementById(this.id);const e=document.getElementsByClassName(this.classes);return 0!==e.length?e[0]:void 0}get state(){return{}}}class o extends i{constructor({text:e,href:t,classes:s="href",id:r}){super(s,{text:e,href:t},r)}bind(){const e=super.domElement;void 0!==e&&(e.onclick=function(e){e.preventDefault(),a.publish("set-page",{url:this.context.href})}.bind(this),console.log("qwe"))}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class c extends i{constructor({classes:e="hamburger-button",callback:t}){super(),this.addClasses(e),this.callback=t}bind(){const e=super.domElement;void 0!==e&&(e.onclick=this.callback)}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class l extends i{constructor({type:e,placeholder:t,classes:s="input",src:r,max:a,min:n,id:i,value:o,isRequired:c,pattern:l,maxlength:u}){super(s,{src:r,type:e,placeholder:t,min:n,max:a,value:o,isRequired:c,pattern:l,maxlength:u},i)}}class u extends i{constructor({classes:e="search-field",callback:t}){super(),this.addClasses(e),this.addContextData({inputButton:new l({type:"image",src:"/static/search.svg",classes:"search-field__input-button"}),inputField:new l({type:"text",placeholder:"Search",classes:"search-field__input-field"})},!0),this.callback=t}bind(){const e=this.domElement;void 0!==e&&(e.getElementsByClassName("search-field__input-button")[0].onclick=this.callback)}unbind(){const e=this.domElement;void 0!==e&&(e.getElementsByClassName("search-field__input-button")[0].onclick=null)}}class d extends i{constructor({classes:e="header"}={}){super(),this.addContextData({hamburgerButton:new c({classes:"header__hamburger-button",callback:()=>{console.log("hamburgerButton clicked")}}),logo:new o({text:"Delivery",href:"/",classes:"header__logo"}),searchField:new u({callback:()=>{console.log("searchFieldButton clicked")},classes:"header__search-field"}),profileButton:new l({type:"image",src:"/static/profile.png",classes:"header__profile-button"})},!0),this.addClasses(e)}}class p extends i{constructor({classes:e="action",href:t,src:s,alt:r="default alt"}){super(),this.addClasses(e),this.addContextData({href:t,src:s,alt:r},!1)}}class h extends i{constructor({classes:e="action-bar",actionArr:t}){super(),this.addClasses(e);const s=[];for(const e of t)s.push(new p({classes:"action-bar__action",src:e.src,alt:e.alt}));this.addContextData({actions:s},!0)}}class m extends i{constructor({src:e,text:t,classes:s="category"}){super(),this.addClasses(s),this.addContextData({src:e,text:t},!1)}}class g extends i{constructor({categoryArr:e,classes:t="categoryBar"}){super(),this.addClasses(t);const s=[];for(const t of e)s.push(new m({src:t.src,text:t.text,classes:"category-bar__category"}));this.addContextData({categories:s},!0)}}class b extends i{constructor({src:e,href:t,classes:s="imageHref",imageClasses:r="imageClasses"}){super(s,{image:new l({type:"image",classes:r,src:e}),href:t})}bind(){const e=super.domElement;void 0!==e?e.onclick=function(e){e.preventDefault(),console.log("href "+this.href+" clicked"),a.publish("set-page",{url:this.context.href})}.bind(this):console.trace("cat' ret myself from DOM")}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class f extends i{constructor({classes:e="place-time-card",place:t="23, Lomonosova st.",time:s="35 min."}){super(e,{place:t,time:s,changePlaceButton:new l({type:"image",classes:"place-time-card__change-place-button",src:"/static/edit.svg"}),changeTimeButton:new l({type:"image",classes:"place-time-card__change-time-button",src:"/static/clock.svg"})})}}class x extends i{constructor({classes:e,src:t,alt:s}){super(e,{src:t,alt:s})}}class _ extends i{constructor({classes:e,imageHref:t,name:s,quantity:r,cost:a,id:n,mainId:i}){super(e,{img:new x({classes:"basket-product__img",src:t,alt:"can't load picture"}),name:s,quantity:r,price:r*a},n),this.mainId=i}bind(){const e=super.domElement;void 0!==e&&(e.onclick=()=>{a.publish("delete-prod",this.mainId),console.log("Del")})}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class v extends i{constructor({classes:e,basket:t}){super(e);const s=[];for(const e in t)s.push(new _({classes:"basket__basket-product",name:t[e].name,imageHref:`/images/${t[e].image}`,quantity:t[e].amount,cost:t[e].price,id:`prod-in-basket-${t[e].id}`,mainId:e}));super.addContextData({basketProducts:s})}}class w extends i{constructor({text:e,callback:t,classes:s="button",id:r}){super(s,{text:e},r),this.callback=t}bind(){const e=super.domElement;void 0!==e&&void 0!==this.callback&&(e.onclick=this.callback)}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class y extends i{constructor({classes:e,label:t,personNum:s=1}){super(e,{label:t,input:new l({id:"person-input__number-input",type:"number",classes:"person-input__input",value:s,min:1,max:1e3})});const r=e=>()=>{const t=this.context.input.domElement,s=Number(t.value)+e;t.min<=s&&s<=t.max&&(t.value=s,a.publish("person-amount-change",t.value))};this.addContextData({minusButton:new w({id:"person-input__minus-button",classes:"person-input__minus-button",text:"-",callback:r(-1)}),plusButton:new w({id:"person-input__plus-button",classes:"person-input__plus-button",text:"+",callback:r(1)})})}}class k extends i{constructor({classes:e,href:t,categoryName:s,id:r}){super(e,{link:new o({classes:"restaurant-category__link",href:t,id:r,text:s})})}}class E extends i{constructor({categoryArr:e,classes:t="restaurant-categories"}){super(),this.addClasses(t);const s=[];for(const t of e)s.push(new k({categoryName:t.text,classes:"restaurant-category-bar__category",href:`/restaurants/${j.restaurantId}`,id:t.id}));this.addContextData({categories:s},!0)}}class C extends i{constructor({classes:e,imgHref:t,name:s,rate:r}){super(e,{imgHref:t,name:s,rateImg:new x({classes:"restaurant__rate-img",src:"static/star.svg",alt:"cat't ;load star image"}),rate:r})}}class I extends i{constructor({classes:e,text:t,callback:s}){super(e,{text:t}),this.callback=s}bind(){const e=super.domElement;void 0!==e&&void 0!==this.callback&&(e.onclick=this.callback)}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class P extends i{constructor({classes:e,product:t}){super("product-card",{imgSrc:`/images/${t.image}`,productName:t.name,productPrice:t.price,button:new I({text:"Add",classes:e,callback:()=>{a.publish("add-product",t)}})})}}class H extends i{constructor({classes:e,productArr:t}){super(),this.addClasses(e);const s=[];for(const e of t)s.push(new P({classes:`product-card-${e.id}`,product:e,id:e.id,imgSrc:`/images/${e.image}`,productDescription:e.price,productName:e.name}));this.addContextData({products:s},!0)}}var D=class extends i{constructor({restaurant:e,products:t,categoryArr:s}){super(),this.addContextData({header:new d({classes:"header"}),order:new O({classes:"order"}),restaurantBanner:new C({classes:"restaurantBanner",imgHref:`/images/${e.image}`,rate:e.rating,name:e.name}),categories:new E({categoryArr:s}),products:new H({classes:"products",productArr:t})},!0)}};var B=new class{constructor(){this.serverPath="http://89.208.199.114:5000"}fetchRequest({path:e="/",method:t="GET",body:s=null,headers:r=!0,type:a="json"}){const n={method:t,mode:"cors",credentials:"include"};return null!=s&&(n.body=s,!0===r&&"json"===a&&(n.headers={"Content-Type":"application/json"})),fetch(`${this.serverPath}${e}`,n)}async fetchGet({path:e}){return await this.fetchRequest({method:"GET",path:e,m:"cors"})}async fetchPost({path:e,body:t,type:s="json"}){return await this.fetchRequest({method:"POST",path:e,body:t,type:s})}async fetchPut({path:e,body:t,type:s="json"}){return await this.fetchRequest({method:"PUT",path:e,body:t,type:s})}async fetchDelete({path:e,body:t}){return await this.fetchRequest({method:"DELETE",path:e,body:t})}};var T=new class{getRestaurant(e){return B.fetchGet({path:`/api/v1/restaurants/${e}`}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}getProducts(e){return B.fetchGet({path:`/api/v1/restaurants/${e}/product`}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}getRestaurants(){return B.fetchGet({path:"/api/v1/restaurants"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}addProduct(e,t){return B.fetchPost({path:`/api/v1/restaurants/${e}/product`,body:t,type:"file"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}addProductImage(e,t){return B.fetchPut({path:`/api/v1/products/${e}/image`,body:t,type:"file"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}addOrder(e){return B.fetchPost({path:"/api/v1/orders/checkout",body:JSON.stringify(e)}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}};var A=new class{constructor(){this.initActions(),this.initCategories(),this.initProducts(),this.initRestaurants(),this.initProfile()}get restaurants(){return this._restaurants}get restaurant(){return this._restaurants[0]}get products(){return this._products}get actions(){return this._actions}get categories(){return this._categories}get profile(){return this._profile}initProfile(){this._profile={avatar:"/static/profile.png",href:"/login",phone:"+7(777)777-77-77",email:"test@email.com"}}initActions(){this._actions=[];for(let e=1;e<=3;e++)this._actions.push({src:`/static/actions/action${e}.jpeg`,href:`/static/actions/action${e}.jpeg`,alt:"cant load"});for(let e=6;e<=10;e++)this._actions.push({src:`/static/actions/action${e}.jpg`,href:`/static/actions/action${e}.jpg`,alt:"cant load"})}initCategories(){this._categories=[];const e=["All","Burgers","Pizza","Asian","Barbecue","Desserts","Thai","Sushi","Магазины","Завтраки","Индийская","Узбекская","Русская","Обеды","Мясо и рыба","Здоровая еда","Десерты","Пироги","Азиатская","Шашлыки","Фастфуд","Бургеры","Пицца","Суши","Великий пост"];for(let t=1;t<=8;t++)this._categories.push({src:`/static/categories/cat${t}.svg`,text:e[t-1],id:t});for(let t=9;t<=25;t++)this._categories.push({src:`/static/categories/cat${t}.jpg`,text:e[t-1],id:t})}initProducts(){this._products=[{imageHref:"static/basket/BBQBurger.jpg",quantity:1,name:"BBQ Burger",cost:339},{imageHref:"static/basket/FrenchFries.jpg",quantity:2,name:"French fries",cost:139},{imageHref:"static/basket/CocaCola.jpg",quantity:1,name:"Coca-cola",cost:99},{imageHref:"static/basket/BBQBurger.jpg",quantity:1,name:"BBQ Burger",cost:339},{imageHref:"static/basket/FrenchFries.jpg",quantity:2,name:"French fries",cost:139},{imageHref:"static/basket/CocaCola.jpg",quantity:1,name:"Coca-cola",cost:99}]}initRestaurants(){this._restaurants=[{name:"Badel Story",imageHref:"/static/restaurants/BagelStory.jpg",rate:4.3,avgDeliveryTime:45,href:"/restaurants"},{name:"La Paris Dakar",imageHref:"/static/restaurants/LaParisDakar.jpg",rate:4.7,avgDeliveryTime:25,href:"/restaurant/"},{name:"The Estamient",imageHref:"/static/restaurants/TheEstamient.jpg",rate:4.1,avgDeliveryTime:35,href:"/restaurants"},{name:"Badel Story",imageHref:"/static/restaurants/BagelStory.jpg",rate:4.3,avgDeliveryTime:45,href:"/restaurants"},{name:"La Paris Dakar",imageHref:"/static/restaurants/LaParisDakar.jpg",rate:4.7,avgDeliveryTime:25,href:"/restaurants"},{name:"The Estamient",imageHref:"/static/restaurants/TheEstamient.jpg",rate:4.1,avgDeliveryTime:35,href:"/restaurants"},{name:"Badel Story",imageHref:"/static/restaurants/BagelStory.jpg",rate:4.3,avgDeliveryTime:45,href:"/restaurants"},{name:"La Paris Dakar",imageHref:"/static/restaurants/LaParisDakar.jpg",rate:4.7,avgDeliveryTime:25,href:"/restaurants"},{name:"The Estamient",imageHref:"/static/restaurants/TheEstamient.jpg",rate:4.1,avgDeliveryTime:35,href:"/restaurants"},{name:"Badel Story",imageHref:"/static/restaurants/BagelStory.jpg",rate:4.3,avgDeliveryTime:45,href:"/restaurants"},{name:"La Paris Dakar",imageHref:"/static/restaurants/LaParisDakar.jpg",rate:4.7,avgDeliveryTime:25,href:"/restaurants"},{name:"The Estamient",imageHref:"/static/restaurants/TheEstamient.jpg",rate:4.1,avgDeliveryTime:35,href:"/restaurants"}]}};var j=new class extends n{constructor(e="Restaurant"){super(e),this.restaurantId=0}execute(e){this.restaurantId=e[0],T.getRestaurant(this.restaurantId).then(e=>{T.getProducts(this.restaurantId).then(t=>{const s=A.categories,r=U.basket.product;super.execute(new D({restaurant:e,products:t,basket:r,categoryArr:s}))}).catch(e=>console.log(e))}).catch(e=>console.log(e))}};class N extends i{constructor({classes:e,id:t,text:s}){super(e,{text:s},t)}appendClasses(e){this.domElement.className+=" "+e}replaceClasses(e){this.domElement.className=e}addMessage(e){this.domElement.innerText+=e}replaceMessage(e){this.domElement.innerText=e}clean(){this.replaceMessage("")}}class F{static inputValidation(e,t){const[s,r]=this.inputCheck(e.domElement);return this.showErrors(t,r),s}static inputCheck(e){const t=[],s=e.validity;return s.valid?[!0,t]:(s.valueMissing&&t.push("Required field"),s.typeMismatch&&t.push("Wrong type"),s.patternMismatch&&t.push("Wrong format"),s.tooLong&&t.push(`Must be less than ${e.maxLength} symbols`),s.tooShort&&t.push(`Must be less than ${e.minLength} symbols`),s.rangeUnderflow&&t.push(`Must be more than ${e.min}`),s.rangeOverflow&&t.push(`Must be less than ${e.max}`),s.stepMismatch&&t.push(`Must have step ${e.step}`),s.badInput&&t.push("Browser can't convert your input"),s.customError&&t.push("unexpected error... lights off... "),[!1,t])}static showErrors(e,t){e.replaceMessage(t.join("\n"))}}class S extends i{constructor({classes:e,data:t}){super(e,{fNameInput:new l({classes:"profile-text-area__input",id:"fname-input",type:"text",value:t.User.firstName,placeholder:"first name",isRequired:!0}),firstNameErrorField:new N({id:"profile-first-name-error"}),lNameInput:new l({classes:"profile-text-area__input",id:"lname-input",type:"text",value:t.User.lastName,placeholder:"last name",isRequired:!0}),lastNameErrorField:new N({id:"profile-second-name-error"}),EmailInput:new l({classes:"profile-text-area__input",id:"email-input",type:"email",value:t.User.email,pattern:"^([A-Za-z0-9_\\-\\.])+@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$",placeholder:"email@example.com"}),emailErrorField:new N({id:"profile-email-error"}),Image:new x({classes:"profile-avatar-area__image",src:`/images/${t.User.profile_photo}`}),avatarErrorField:new N({id:"profile-avatar-error"}),AvatarInput:new l({classes:"profile-avatar-area__image-input",id:"profile-avatar-area__image-input",type:"file",value:"xxx"}),generalErrorField:new N({id:"profile-general-error"})}),this.addContextData({SubmitButton:new I({text:"Save",classes:"profile-update__submit-btn",callback:()=>{let e;if(this.context.generalErrorField.clean(),e=F.inputValidation(this.context.fNameInput,this.context.firstNameErrorField),e=F.inputValidation(this.context.lNameInput,this.context.lastNameErrorField)&&e,e=F.inputValidation(this.context.EmailInput,this.context.emailErrorField)&&e,!1===e)return;const t={firstName:this.context.fNameInput.domElement.value,lastName:this.context.lNameInput.domElement.value,email:this.context.EmailInput.domElement.value};a.publish("update-user",t)}}),LogoutButton:new I({text:"Log Out",classes:"profile-update__logout-btn",callback:()=>{a.publish("log-out")}})})}bind(){this.context.AvatarInput.domElement.addEventListener("change",()=>{const e=this.context.AvatarInput.domElement.files[0],t=new FormData;t.append("avatar",e),this.context.avatarErrorField.clean(),a.publish("avatar-update",t)}),a.subscribe("update-bio-error",e=>{this.context.generalErrorField.addMessage(e)}),a.subscribe("update-avatar-error",e=>{this.context.avatarErrorField.addMessage(e)}),super.bind()}}class M extends i{constructor({profile:e}){super(),this.addContextData({Header:new d({classes:"header"}),ProfileTextArea:new S({classes:"profile-view__profile-area",data:e})})}}var q=new class{getUser(){return B.fetchGet({path:"/api/v1/profile"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}createUser(e){return B.fetchPost({path:"/api/v1/signup",body:JSON.stringify(e)}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}updateUser(e){return B.fetchPut({path:"/api/v1/profile/bio",body:JSON.stringify(e)}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}updateAvatar(e){return B.fetchPut({path:"/api/v1/profile/avatar",body:e,type:"file"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}};var R=new class{login(e){return B.fetchPost({path:"/api/v1/signin",body:JSON.stringify(e)}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}logout(){return B.fetchPost({path:"/api/v1/logout"}).then(e=>{const t=e.headers.get("X-Csrf-Token");return"undefined"!==t&&localStorage.setItem("X-Csrf-Token",t),e.json()})}};var $=new class extends n{constructor(e="profile page"){super(e)}execute(){q.getUser().then(e=>{"Unauthorized"===e.error?a.publish("redirect",{url:"/login"}):super.execute(new M({profile:e}))}).catch(e=>{console.log(e)})}startCatchEvents(){a.subscribe("update-user",this.updateBioHandler.bind(this)),a.subscribe("log-out",this.logoutHandler.bind(this)),a.subscribe("avatar-update",this.updateAvatarHandler.bind(this))}stopCatchEvents(){a.unsubscribe("update-user",this.updateBioHandler.bind(this)),a.unsubscribe("log-out",this.logoutHandler.bind(this)),a.unsubscribe("avatar-update",this.updateAvatarHandler.bind(this))}logoutHandler(){console.log("qwer"),R.logout().then(e=>{e.error?a.publish("logout-error",e.error):a.publish("set-page",{url:"/login"})}).catch(e=>{a.publish("logout-error","Bad connection"),console.log(e)})}updateBioHandler(e){q.updateUser(e).then(e=>{e.error?a.publish("update-bio-error",e.error):a.publish("set-page",{url:"/me"})}).catch(e=>{console.log(e),a.publish("update-bio-error","Bad connection")})}updateAvatarHandler(e){q.updateAvatar(e).then(e=>{e.error?a.publish("update-avatar-error",e.error):a.publish("set-page",{url:"/me"})}).catch(e=>{console.log(e),a.publish("update-avatar-error","Bad connection")})}};var U=new class extends n{constructor(){super(),this.basket={owner:-1,product:{}},this.total=0,this.persons=1}startCatchEvents(){a.subscribe("add-product",this.addProductHandler.bind(this)),a.subscribe("person-amount-change",this.personAmountChangeHandler.bind(this)),a.subscribe("success-login",this.CheckBasketHandler.bind(this)),a.subscribe("log-out",this.cleanBasketHandler.bind(this)),a.subscribe("delete-prod",this.deleteProductHandler.bind(this))}stopCatchEvents(){a.unsubscribe("add-product",this.addProductHandler.bind(this)),a.unsubscribe("person-amount-change",this.personAmountChangeHandler.bind(this)),a.unsubscribe("success-login",this.CheckBasketHandler.bind(this)),a.unsubscribe("log-out",this.cleanBasketHandler.bind(this)),a.unsubscribe("delete-prod",this.deleteProductHandler.bind(this))}productNumber(){return Object.keys(this.basket).length}isEmpty(){return 0===this.productNumber()}addProductHandler(e){e.id in this.basket.product?this.basket.product[e.id].amount++:(this.basket.product[e.id]=e,this.basket.product[e.id].amount=1),a.publish("set-page",{url:`/restaurants/${j.restaurantId}`})}deleteProductHandler(e){console.log(e),e in this.basket.product&&(1===this.basket.product[e].amount?delete this.basket.product[e]:this.basket.product[e].amount>1&&this.basket.product[e].amount--,a.publish("set-page",{url:`/restaurants/${j.restaurantId}`}))}personAmountChangeHandler(e){e>0&&(this.persons=e)}CheckBasketHandler(e){console.log(this.basket.owner,e),this.basket.owner!==e&&(this.basket={owner:e,product:{}})}cleanBasketHandler(e){this.basket={owner:-1,product:{}}}};class O extends i{constructor({basket:e=U.basket.product,classes:t="order",withCheckoutButton:s=!0,personNum:r=U.persons}){super(),this.addClasses(t),this.addContextData({title:"My Order",total:()=>{let t=0;for(const s in e)t+=e[s].price*e[s].amount;return U.total=t,t},profileButton:new b({classes:"order__profile-href",imageClasses:"order__profile-image",src:"/static/profile.png",href:"/login"}),placeTimeCard:new f({classes:"order__place-time-card"}),basket:new v({classes:"order__basket",basket:e}),personInput:new y({classes:"order__person-input",label:"Persons:",personNum:r})}),s&&this.addContextData({checkout:new o({classes:"order__checkout",text:"Checkout",href:"/checkout"})})}}class X extends i{constructor({classes:e,text:t,callback:s}){super(e,{textButton:new w({classes:"select-time-button__text-button",text:t,callback:s}),imageButton:new w({classes:"select-time-button__image-button",callback:s})})}}class L extends i{constructor({classes:e,name:t,imageHref:s,rate:r,avgDeliveryTime:a,href:n}){super(e,{name:t,rate:r,href:n,avgDeliveryMinTime:a,avgDeliveryMaxTime:a+5,img:new x({classes:"restaurant__img",src:s,alt:"can't load image"}),rateImg:new x({classes:"restaurant__rate-img",src:"static/star.svg",alt:"cat't ;load star image"})})}bind(){const e=super.domElement;void 0!==e&&(e.onclick=function(e){e.preventDefault(),a.publish("set-page",{url:this.context.href})}.bind(this))}unbind(){const e=super.domElement;void 0!==e&&(e.onclick=null)}}class z extends i{constructor({classes:e,restaurantArr:t}){super(e);const s=[];for(const e of t)s.push(new L({classes:`restaurant-list__restaurant-${e.id}`,name:e.name,avgDeliveryTime:30,rate:e.rating,imageHref:`/images/${e.image}`,href:`/restaurants/${e.id}`}));this.addContextData({restaurantComponents:s})}}var V=class extends i{constructor({actionArr:e,categoryArr:t,restaurantArr:s}){super(),this.addContextData({label:"Restaurants",selectTimeButton:new X({classes:"main-view__select-time-button",imageHref:"static/clock.svg",text:"Delivery: now",callback:()=>0}),header:new d({classes:"header"}),actionBar:new h({classes:"action-bar",actionArr:e}),categoryBar:new g({classes:"category-bar",categoryArr:t}),order:new O({classes:"order"}),restaurantList:new z({classes:"main-view__restaurant-list",restaurantArr:s})},!0)}};var G=new class extends n{constructor(e="main page"){super(e)}execute(){T.getRestaurants().then(e=>{const t=A.actions,s=A.categories;super.execute(new V({actionArr:t,categoryArr:s,restaurantArr:e.Restaurants,products:U.basket.product}))}).catch(e=>{console.log(e),super.execute(new V({actionArr:A.actions,categoryArr:A.categories,restaurantArr:A.restaurants,products:U.basket.product}))})}};var Z=new class extends n{execute(){document.body.innerHTML="<b>404...zzz...404...zzz</b>"}stop(){}}(void 0);class J extends i{constructor({classes:e}){super(e,{phoneInput:new l({classes:"login-field__input",id:"login-field__email-input",type:"tel",placeholder:"8(800)555-35-35",isRequired:!0,pattern:"\\d\\(\\d{3}\\)\\d{3}-\\d{2}-\\d{2}"}),passwordInput:new l({classes:"login-field__input",id:"login-field__password-input",type:"password",placeholder:"password",isRequired:!0}),phoneErrorField:new N({id:"indent-input-err"}),passwordErrorField:new N({id:"password-input-err"}),generalErrorField:new N({id:"login-general-error"})}),this.addContextData({submitButton:new I({classes:"login-field__submit",text:"Log In",callback:()=>{let e;if(this.context.generalErrorField.clean(),e=F.inputValidation(this.context.phoneInput,this.context.phoneErrorField),e=F.inputValidation(this.context.passwordInput,this.context.passwordErrorField)&&e,!1===e)return;const t={phone:this.context.phoneInput.domElement.value,password:this.context.passwordInput.domElement.value};a.publish("login",t)}})})}bind(){a.subscribe("login-error",e=>{this.context.generalErrorField.addMessage(e)}),super.bind()}unbind(){a.unsubscribe("login-error",e=>{this.context.generalErrorField.addMessage(e)}),super.unbind()}}class Q extends i{constructor({classes:e}){super(e,{fNameInput:new l({classes:"signup-field__input",id:"signup-field__fname-input",type:"text",placeholder:"first name",isRequired:!0}),lNameInput:new l({classes:"signup-field__input",id:"signup-field__lname-input",type:"text",placeholder:"last name",isRequired:!0}),phoneInput:new l({classes:"signup-field__input",id:"signup-field__phone-input",type:"phone",placeholder:"8(800)555-35-35",isRequired:!0,pattern:"\\d\\(\\d{3}\\)\\d{3}-\\d{2}-\\d{2}"}),passwordInput1:new l({classes:"signup-field__input",id:"signup-field__password-input1",type:"password",placeholder:"GoodyGoody456",isRequired:!0}),passwordInput2:new l({classes:"signup-field__input",id:"signup-field__password-input2",type:"password",placeholder:"GoodyGoody456",isRequired:!0}),firstNameErrorField:new N({id:"first-name-input-err"}),lastNameErrorField:new N({id:"last-name-input-err"}),phoneErrorField:new N({id:"phone-error"}),password1ErrorField:new N({id:"password1-error"}),password2ErrorField:new N({id:"password2-error"}),generalErrorField:new N({id:"signup-general-error"})}),this.addContextData({submitButton:new I({classes:"signup-field__submit",text:"Sign Up",callback:()=>{let e;if(this.context.generalErrorField.clean(),e=F.inputValidation(this.context.fNameInput,this.context.firstNameErrorField),e=F.inputValidation(this.context.lNameInput,this.context.lastNameErrorField)&&e,e=F.inputValidation(this.context.phoneInput,this.context.phoneErrorField)&&e,e=F.inputValidation(this.context.passwordInput1,this.context.password1ErrorField)&&e,e=F.inputValidation(this.context.passwordInput2,this.context.password2ErrorField)&&e,this.context.passwordInput1.domElement.value!==this.context.passwordInput2.domElement.value&&(e=!1,this.context.password1ErrorField.addMessage("Passwords must be equal"),this.context.password2ErrorField.addMessage("Passwords must be equal")),!1===e)return;const t={firstName:this.context.fNameInput.domElement.value,lastName:this.context.lNameInput.domElement.value,phone:this.context.phoneInput.domElement.value,password:this.context.passwordInput1.domElement.value};a.publish("signup",t)}})})}bind(){a.subscribe("signup-error",e=>{this.context.generalErrorField.addMessage(e)}),super.bind()}unbind(){a.unsubscribe("signup-error",e=>{this.context.generalErrorField.addMessage(e)}),super.unbind()}}class W extends i{constructor(){super("log"),this.addContextData({Header:new d({classes:"header"}),LoginField:new J({classes:"login-signup__login"}),SignupField:new Q({classes:"login-signup__signup"})})}}var Y=new class extends n{constructor(e="login-signup page"){super(e),this.profileId=0}execute(){q.getUser().then(e=>{"Unauthorized"===e.error?super.execute(new W):a.publish("redirect",{url:"/me"})}).catch(e=>{console.log(e),super.execute(new W)})}startCatchEvents(){a.subscribe("signup",this.signupHandler.bind(this)),a.subscribe("login",this.loginHandler.bind(this))}stopCatchEvents(){a.unsubscribe("signup",this.signupHandler.bind(this)),a.unsubscribe("login",this.loginHandler.bind(this))}signupHandler(e){e.phone=e.phone.replace(/[()-]/g,""),q.createUser(e).then(e=>{e.message&&a.publish("set-page",{url:"/"}),e.error&&a.publish("signup-error",e.error)}).catch(e=>{console.log(e)})}loginHandler(e){e.phone=e.phone.replace(/[()-]/g,""),R.login(e).then(e=>{e.User&&(a.publish("set-page",{url:"/"}),this.profileId=e.User.id,a.publish("success-login",e.User.id)),e.error&&a.publish("login-error",e.error)}).catch(e=>{console.log(e)})}};class K extends i{constructor({classes:e,phone:t,address:s,email:r,profile:n}){super(e,{PhoneInput:new l({classes:"order-checkout__input",id:"order-checkout__phone-input",type:"tel",value:t[0]+"("+t.slice(1,4)+")"+t.slice(4,7)+"-"+t.slice(7,9)+"-"+t.slice(9,11),placeholder:"8(800)555-35-35",isRequired:!0,pattern:"\\d\\(\\d{3}\\)\\d{3}-\\d{2}-\\d{2}"}),PhoneError:new N({id:"phone-input-error"}),AddressInput:new l({classes:"order-checkout__input",id:"order-checkout__address-input",type:"text",value:s,placeholder:"Enter your address",isRequired:!0}),AddressError:new N({id:"address-input-error"}),EmailInput:new l({classes:"order-checkout__input",id:"order-checkout__email-input",type:"email",value:r,pattern:"^([A-Za-z0-9_\\-\\.])+@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$",placeholder:"email@example.com"}),EmailError:new N({id:"email-input-error"}),CommentInput:new l({classes:"order-checkout__input",id:"order-checkout__comment-input",type:"text",placeholder:"Enter your comment"}),GeneralError:new N({id:"general-error"})}),this.addContextData({SubmitButton:new I({classes:"order-checkout__confirm",text:"Confirm",callback:()=>{let e;if(this.context.GeneralError.clean(),e=F.inputValidation(this.context.PhoneInput,this.context.PhoneError),e=F.inputValidation(this.context.AddressInput,this.context.AddressError)&&e,e=F.inputValidation(this.context.EmailInput,this.context.EmailError)&&e,U.isEmpty()&&(this.context.GeneralError.addMessage("Your basket is empty"),e=!1),!1===e)return;const t=[],s=U.basket;for(const e in s){const r={productId:parseInt(e),count:s[e].amount};t.push(r)}const r={userId:n.id,phone:this.context.PhoneInput.domElement.value,address:this.context.AddressInput.domElement.value,email:this.context.EmailInput.domElement.value,comment:this.context.CommentInput.domElement.value,personNum:U.persons,price:U.total,products:t};a.publish("checkout",r)}})})}bind(){a.subscribe("order-checkout-error",e=>{this.context.GeneralError.addMessage(e)}),super.bind()}unbind(){a.unsubscribe("order-checkout-error",e=>{this.context.GeneralError.addMessage(e)}),super.unbind()}}class ee extends i{constructor({profile:e,personNum:t}){super(),this.addContextData({Header:new d({classes:"header"}),Order:new O({classes:"order",withCheckoutButton:!1}),OrderCheckout:new K({classes:"order-confirmation",phone:e.phone,address:e.address,email:e.email,profile:e,personNum:t})})}}var te=new class extends n{constructor(e="confirm"){super(e)}execute(){q.getUser().then(e=>{"Unauthorized"===e.error?a.publish("redirect",{url:"/login"}):super.execute(new ee({profile:e.User,basket:U.basket.product,personNum:U.persons}))}).catch(e=>{console.log(e),a.publish("redirect",{url:"/"})})}startCatchEvents(){a.subscribe("checkout",this.checkoutHandler.bind(this))}stopCatchEvents(){a.unsubscribe("checkout",this.checkoutHandler.bind(this))}checkoutHandler(e){T.addOrder(e).then(e=>{e.error?a.publish("order-checkout-error",e.error):a.publish("set-page",{url:"/"})}).catch(e=>{console.log(e),a.publish("order-checkout-error",e)})}};class se extends i{constructor({classes:e}){super(e,{nameInput:new l({classes:"add-product-by-restaurant__input",id:"add-product-by-restaurant__name-input",type:"text",placeholder:"Name",isRequired:!0}),nameError:new N({id:"name-error"}),costInput:new l({classes:"add-product-by-restaurant__input",id:"add-product-by-restaurant__cost-input",type:"number",placeholder:"Price",min:"0",max:1e4,isRequired:!0}),costError:new N({id:"cost-error"}),Image:new l({classes:"add-product-by-restaurant__image-input",id:"add-product-by-restaurant__image-input",type:"file",value:"xxx",isRequired:!0}),ImageError:new N({id:"image-error"}),generalError:new N({id:"general-error"})}),this.addContextData({submitButton:new I({classes:"add-product-by-restaurant__submit",text:"Add",callback:()=>{let e;if(this.context.generalError.clean(),e=F.inputValidation(this.context.nameInput,this.context.nameError),e=F.inputValidation(this.context.costInput,this.context.costError)&&e,e=F.inputValidation(this.context.Image,this.context.ImageError)&&e,!1===e)return;const t=new FormData;t.append("image",this.context.Image.domElement.files[0]),t.append("Name",this.context.nameInput.domElement.value),t.append("Price",this.context.costInput.domElement.value),a.publish("add-product-by-restaurant",t)}})})}bind(){a.subscribe("add-product-by-restaurant-error",e=>{this.context.generalError.addMessage(e)}),super.bind()}unbind(){a.unsubscribe("add-product-by-restaurant-error",e=>{this.context.generalError.addMessage(e)}),super.unbind()}}class re extends i{constructor(){super(),this.addContextData({header:new d({classes:"header"}),addProducts:new se({})})}}var ae=new class extends n{constructor(e="Add product"){super(e)}execute(e){this.restaurant=e[0],q.getUser().then(e=>{"Moderator"===e.User.role||"Admin"===e.User.role?super.execute(new re):a.publish("set-page",{url:"/"})}).catch(e=>console.log(e))}startCatchEvents(){a.subscribe("add-product-by-restaurant",this.addProductHandler.bind(this))}stopCatchEvents(){a.unsubscribe("add-product-by-restaurant",this.addProductHandler.bind(this))}addProductHandler(e){T.addProduct(this.restaurant,e).then(e=>{e.error?a.publish("add-product-by-restaurant-error",e.error):e.message&&a.publish("set-page",{url:`/restaurants/${this.restaurant}`})}).catch(e=>{a.publish("add-product-by-restaurant-error",e)})}};new class{constructor(){this._currentController=void 0,this._pages=[],this._registerAllPages(),this._initAdditionalControllers(),a.subscribe("set-page",this._goto.bind(this)),a.subscribe("redirect",this._redirect.bind(this)),window.onpopstate=this._handlePopState.bind(this)}_handlePopState(e){let t;e.preventDefault(),this._currentController&&this._currentController.stop(),[this._currentController,t]=this._matchUrl(window.location.pathname)||[Z],this._currentController.execute(document.location,t)}_initAdditionalControllers(){U.startCatchEvents()}_redirect({url:e}){let t;this._currentController&&this._currentController.stop(),[this._currentController,t]=this._matchUrl(e)||[Z],history.replaceState(this._currentController.state,this._currentController.title,e),this._currentController.execute(t)}_goto({url:e}){let t;this._currentController&&this._currentController.stop(),[this._currentController,t]=this._matchUrl(e)||[Z],this._setNewHistoryRecord(this._currentController,e),this._currentController.execute(t)}_setNewHistoryRecord(e,t){history.pushState({},e.title,t)}_registerAllPages(){this._registerPage(G,"/"),this._registerPage($,"/me"),this._registerPage(Y,"/login"),this._registerPage(Y,"/signup"),this._registerPage(j,"/restaurants/:int"),this._registerPage(te,"/checkout"),this._registerPage(ae,"/restaurants/:int/add")}_registerPage(e,t){this._pages.push({pattern:new RegExp("^"+t.replace(/:\w+/,"(\\w+)")+"$"),page:e})}_matchUrl(e){for(const t of this._pages){const s=e.match(t.pattern);if(s)return[t.page,s.slice(1)]}}};a.publish("set-page",{url:window.location.pathname})}]);